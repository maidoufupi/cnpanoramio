"use strict";!function(){function a(a,b,c,d){angular.forEach(b.split(" "),function(b){window.AMap.event.addListener(c,b,function(c){d.triggerHandler("map-"+b,c),a.$$phase||a.$apply()})})}function b(b,c){e.directive(b,[function(){return{restrict:"A",link:function(d,e,f){d.$watch(f[b],function(b){b&&a(d,c,b,e)})}}}])}function c(a,b){var c,e=[],g=function(a,b){b=angular.isFunction(b)?b():null==b?"":b,e[e.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(angular.isArray(a)||a.jquery&&!angular.isObject(a))angular.forEach(a,function(){g(this.name,this.value)});else for(c in a)d(c,a[c],b,g);return e.join("&").replace(f,"+")}function d(a,b,c,e){var f;if(angular.isArray(b))angular.forEach(b,function(b,f){c||rbracket.test(a)?e(a,b):d(a+"["+("object"==typeof b?f:"")+"]",b,c,e)});else if(!c&&angular.isObject(b))for(f in b)d(a+"["+f+"]",b[f],c,e);else e(a,b)}var e=angular.module("ui.map",["ui.event"]);e.value("uiMapConfig",{}).directive("uiMap",["uiMapConfig","$window","$parse",function(b,c,d){var e="complete click dblclick mapmove movestart moveend zoomchange zoomstart zoomend mousemove mousewheel mouseover mouseout mouseup mousedown rightclick dragstart dragging dragend resize touchstart touchmove touchend",f=b||{};return{restrict:"A",link:function(b,g,h){function i(){k.uiMapCache&&window[h.uiMapCache]?(g.replaceWith(window[h.uiMapCache]),j=window[h.uiMapCache+"Map"]):(j=new window.AMap.Map(g[0],k),k.toolbar&&j.plugin(["AMap.ToolBar"],function(){var a=new AMap.ToolBar({ruler:k.ruler});j.addControl(a)}),"SATELLITE"==k.maptype?j.plugin(["AMap.MapType"],function(){var a=new AMap.MapType({defaultType:1,showRoad:!0});j.addControl(a)}):k.maptype&&j.plugin(["AMap.MapType"],function(){var a=new AMap.MapType({defaultType:0,showRoad:!0});j.addControl(a)}),k.overview&&j.plugin(["AMap.OverView"],function(){var a=new AMap.OverView({isOpen:k.overview.isOpen||!1});j.addControl(a)}),k.uiMapCache&&(c[h.uiMapCache+"Map"]=j,b.$on("$destroy",function(){c[h.uiMapCache]=g})));var f=d(h.uiMap);f.assign(b,j),a(b,e,j,g)}var j,k=angular.extend({},f,b.$eval(h.uiOptions));b.$on("map.loaded",function(a,b){"gaode"!=b||j||i()}),c.AMap&&i()}}}]),e.value("uiMapInfoWindowConfig",{}).directive("uiMapInfoWindow",["uiMapInfoWindowConfig","$window","$parse","$compile",function(b,c,d,e){var f="change open close",g=b||{};return{link:function(b,h,i){function j(){m||(m=new window.AMap.InfoWindow(k),l.assign(b,m)),a(b,f,m,h),h.replaceWith("<div></div>");var c=m.open;m.open=function(a,d,f,g,i,j){e(h.contents())(b),c.call(m,a,d,f,g,i,j)}}var k=angular.extend({},g,b.$eval(i.uiOptions));k.content=h[0];var l=d(i.uiMapInfoWindow),m=l(b);b.$on("map.loaded",function(a,b){"gaode"!=b||m||j()}),c.AMap&&j()}}}]),b("uiMapMarker","click dblclick rightclick mousemove mouseover mouseout mousedown mouseup dragstart dragging dragend moving moveend movealong touchstart touchmove touchend"),b("uiMapPolyline","click dblclick rightclick hide show mousedown mouseup mouseover mouseout change touchstart touchmove touchend"),b("uiMapPolygon","click dblclick rightclick hide show mousedown mouseup mouseover mouseout change touchstart touchmove touchend"),b("uiMapCircle","click dblclick rightclick hide show mousedown mouseup mouseover mouseout change touchstart touchmove touchend"),b("uiMapGroundImage","click dblclick"),e.provider("uiMapLoadParams",function(){var a={};this.setParams=function(b){a=b},this.$get=function(){return a}}).directive("uiMapAsyncLoad",["$window","$parse","uiMapLoadParams",function(a,b,d){return{restrict:"A",link:function(b,e,f){a.mapgaodeLoadedCallback=function(){b.$broadcast("map.loaded","gaode")};var g=angular.extend({},d,b.$eval(f.uiMapAsyncLoad));if(g.callback="mapgaodeLoadedCallback",a.AMap)mapgaodeLoadedCallback();else{var h=document.createElement("script");h.type="text/javascript",h.src="http://webapi.amap.com/maps?"+c(g),document.body.appendChild(h)}}}}]);var f=/%20/g}(),function(a){"function"==typeof define&&define.amd?define([window,"jquery","cnmap"],a):a(window,jQuery)}(function(a){return a.cnmap.MapEventListener=function(b){this.opts=b||this.opts,this.addLocationHashListener=function(b,c){function d(){var a=b.getCenter();c.apply(this,[a.lat,a.lng,b.getZoom()])}var e=[];return e.push(a.AMap.event.addListener(b,"zoomend",d)),e.push(a.AMap.event.addListener(b,"moveend",d)),e},this.removeListener=function(b){b&&$.each(b,function(b,c){a.AMap.event.removeListener(c)})},this.addToolBar=function(a){a.plugin(["AMap.ToolBar"],function(){var b=new AMap.ToolBar;a.addControl(b)})},this.setCenter=function(a,b,c){var d=new AMap.LngLat(c,b);a.setCenter(d)},this.setZoom=function(a,b){a.setZoom(b)},this.setZoomAndCenter=function(a,b,c,d){var e=new AMap.LngLat(d,c);a.setZoomAndCenter(b,e)},this.zoomIn=function(a){a.zoomIn()},this.zoomOut=function(a){a.zoomOut()},this.setBounds=function(a,b,c){a.setBounds(new AMap.Bounds(new AMap.LngLat(b.lng,b.lat),new AMap.LngLat(c.lng,c.lat)))},this.clearMap=function(a){return a&&a.clearMap()},this.inMapView=function(a,b,c){c=c||this.opts.map;var d=new AMap.LngLat(b,a);return c.getBounds().contains(d)},this.pixelToPoint=function(a,b){return a.containerToLngLat(new AMap.Pixel(b.x,b.y))},this.pointToPixel=function(a,b){return a.lngLatToContainer(new AMap.LngLat(b.lng,pixel.lat))},this.addMarker=function(a,b,c){return new AMap.Marker({map:a,position:new AMap.LngLat(c,b),topWhenMouseOver:!0})},this.createDraggableMarker=function(a,b,c){return new AMap.Marker({draggable:!0,map:a,position:new AMap.LngLat(c,b),topWhenClick:!0,topWhenMouseOver:!0})},this.activeMarker=function(a){a&&(a.setzIndex(2),a.setIcon("images/marker.png"))},this.deactiveMarker=function(a){a&&(a.setzIndex(1),a.setIcon(""))},this.addMarkerActiveListener=function(a,b){function c(){b.apply(a,[])}AMap.event.addListener(a,"click",c),AMap.event.addListener(a,"touchstart",c),AMap.event.addListener(a,"dragend",c)},this.addDragendListener=function(a,b){AMap.event.addListener(a,"dragend",function(c){b.apply(a,[c.lnglat.lat,c.lnglat.lng])})},this.removeMarker=function(a){a.setMap(null)},this.addMapClickListener=function(a,b){AMap.event.addListener(a,"click",function(c){var d=c.lnglat;b.apply(a,[d.lat,d.lng])})},this.setPosition=function(a,b,c){var d=new AMap.LngLat(c,b);a.setPosition(d)},this.setMap=function(a,b){a.setMap(b),a.show()}},a.cnmap.MapEventListener.prototype=a.cnmap.IMapEventListener,a.cnmap.MapEventListener.factory=function(){return new a.cnmap.MapEventListener},a.cnmap.MapEventListener}),function(a){"function"==typeof define&&define.amd?define([window,"jquery","cnmap"],a):a(window,jQuery)}(function(a){return a.cnmap.MapService=function(a){var b={"国家":3,"省":7,"市":9,"区县":11,"乡镇":13,"村庄":16,"热点商圈":16,"小区":18,"兴趣点":18,"门牌号":19,"道路":17,"道路交叉路口":18,"公交站台、地铁站":18};this.map=a||this.map;var c;this.init=function(a,b){a&&(a instanceof Function?b=a:this.map=a),this.map.plugin(["AMap.Geocoder"],function(){c=new AMap.Geocoder({radius:1e3,extensions:"all"}),b&&b.apply(c,[c])})},this.getAddress=function(a,b,d){function e(){AMap.event.addListenerOnce(c,"complete",function(a){"OK"==a.info&&d.apply(void 0,[a.regeocode.formattedAddress])}),c.getAddress(f)}var f=new AMap.LngLat(b,a);c?e():this.init(function(){e()})};var d=[];this.getAddrPois=function(a,b){function e(){d.length?d.push({point:h,deferred:g}):(d.push({point:h,deferred:g}),f())}function f(){if(d.length){var a=d[0],b=a.deferred;AMap.event.addListenerOnce(c,"complete",function(a){var c={};if("OK"==a.info){var e=a.regeocode,g=e.addressComponent.province+e.addressComponent.district+e.addressComponent.city+e.addressComponent.township;$.each(e.pois,function(a,b){var d=g+b.address;b.name&&(d=d+" "+b.name),c[d]={poiweight:b.poiweight,location:b.location,distance:b.distance}}),b.resolve(c,e.formattedAddress)}else b.reject(a.info);delete d.splice(0,1),f()}),c.getAddress(a.point)}}var g=jQuery.Deferred(),h=new AMap.LngLat(b,a);return c?e():this.init(function(){e()}),g.promise()},this.getLocation=function(a,b){function d(){AMap.event.addListenerOnce(c,"complete",function(a){"OK"==a.info&&b.apply(void 0,[a])}),c.getLocation(a)}c?d():this.init(function(){d()})},this.getLocPois=function(a){function d(){AMap.event.addListenerOnce(c,"complete",function(a){var c=[];"OK"==a.info&&$.each(a.geocodes,function(a,d){c.push({address:d.formattedAddress,location:d.location,similarity:1,zoom:b[d.level]||4})}),e.resolve(c)}),c.getLocation(a)}var e=jQuery.Deferred();return c?d():this.init(function(){d()}),e.promise()}},a.cnmap.MapService.prototype=a.cnmap.IMapService,a.cnmap.MapService.factory=function(){return new a.cnmap.MapService},a.cnmap.MapService}),function(){var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};a=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.createPoint=function(a){return new AMap.LngLat(a.point.lng,a.point.lat)},b.prototype.createMarker=function(a){var b,c;return c=this,b=new AMap.Marker({map:this.map,position:new AMap.LngLat(a.point.lng,a.point.lat),offset:new AMap.Pixel(-15,-15),content:this.getLabelContent(a.oss_key),topWhenClick:!0}),b.photo=a,this.opts.clickable&&AMap.event.addListener(b,"click",function(){return jQuery(c).trigger("data_clicked",[this.photo.id])}),a.marker=b,b},b.prototype.createPolyline=function(a){return new AMap.Polyline({map:this.map,path:a,strokeWeight:2})},b.prototype.setPolylinePath=function(a,b){return a.setPath(b)},b.prototype.removeMarker=function(a){return a.marker?(a.marker.setMap(null),delete a.marker):void 0},b.prototype.toggleSpotLine=function(a,b){return a.polyline?b?a.polyline.show():a.polyline.hide():void 0},b.prototype.spotEditable=function(a,b){var c,d,e,f,g,h,i;for(b=!!b,e=this,c=function(c){if(c){if(c.setDraggable(e.opts.editable&&b),e.opts.editable&&b)return c.dragListener=AMap.event.addListener(c,"dragend",function(b){return this.photo.oPoint||(this.photo.oPoint=$.extend({},this.photo.point)),this.photo.point.lat=b.lnglat.getLat(),this.photo.point.lng=b.lnglat.getLng(),e.updateSpotLine(a),$(e).trigger("spot.edited",[a.id])});if(c.dragListener)return AMap.event.removeListener(c.dragListener),c.dragListener=null}},h=a.photos,i=[],f=0,g=h.length;g>f;f++)d=h[f],i.push(c(d.marker));return i},b.prototype.cancelSpotEdit=function(a){var b,c,d,e,f;for(b=function(a){return a.oPoint&&(a.point=a.oPoint,delete a.oPoint),a.marker?a.marker.setPosition(new AMap.LngLat(a.point.lng,a.point.lat)):void 0},f=a.photos,d=0,e=f.length;e>d;d++)c=f[d],b(c);return this.updateSpotLine(a)},b.prototype.createSpot=function(a){var b,c,d,e,f,g;for(c=0,g=a.photos,e=0,f=g.length;f>e;e++)d=g[e],b=window.cnmap.GPS.distanceInMeter(a.center_lat,a.center_lng,d.point.lat,d.point.lng),b>c&&(c=b);return new AMap.Circle({map:this.map,center:new AMap.LngLat(a.center_lng,a.center_lat),radius:c,strokeStyle:"dashed",strokeColor:"#0066FF",strokeOpacity:.2,fillColor:"#0066FF",fillOpacity:.2})},b}(window.cnmap.ITravelLayer),window.cnmap.TravelLayer=a}.call(this),function(a){"function"==typeof define&&define.amd?define([window,"jquery","Panoramio"],a):a(window,jQuery)}(function(a,b){return a.cnmap=a.cnmap||{},a.cnmap.PanoramioLayer=function(a){var c=[],d=null;this.preZoom=0,this.preBounds=null,this.opts=b.extend({clickable:!0,auto:!0},a),this.opts.map&&this.setMap(this.opts.map),this.setMap=function(c){function e(){g&&clearTimeout(g),g=setTimeout(function(){f()},500)}function f(){if(b(h).trigger("map_changed",[h.getBounds(),h.getLevel(),h.getSize()]),h.opts.auto){c.getBounds(),c.getSize(),h.getBoundsThumbnails(h.getBounds(),h.getLevel(),h.getSize())}}c?(this.opts.map=c,d=new AMap.InfoWindow({isCustom:!1,closeWhenClickMap:!0}),AMap.event.addListener(c,"complete",e),AMap.event.addListener(c,"zoomend",function(a){c.getZoom()!=this.preZoom&&(this.preZoom=c.getZoom(),e(a))}),AMap.event.addListener(c,"moveend",e)):(a.map,c.clearMap(),clearVisible());var g,h=this},this.hideLabel=function(a){c[a]&&c[a].setMap(null)},this.createMarker=function(e){var f=this.opts.map,g=this;if(c[e.id])c[e.id].setMap(f);else{var h=new AMap.Marker({map:f,position:new AMap.LngLat(e.point.lng,e.point.lat),offset:new AMap.Pixel(0,0),content:g.getLabelContent(e.oss_key)});h.photoId=e.id,g.opts.clickable&&AMap.event.addListener(h,"click",function(){a.suppressInfoWindows?d.getIsOpen()?d.close():(d.setContent(g.getInfoWindowContent(e)),d.open(f,this.getPosition())):b(g).trigger("data_clicked",[this.photoId])}),c[e.id]=h,h.setMap(f)}},this.setOptions=function(b){a=b},this.trigger=function(){this.opts.map&&AMap.event.trigger(this.opts.map,"moveend")},this.center_changed=function(){},this.getBounds=function(){var a=this.opts.map.getBounds();return{ne:{lat:a.getNorthEast().lat,lng:a.getNorthEast().lng},sw:{lat:a.getSouthWest().lat,lng:a.getSouthWest().lng}}},this.getLevel=function(){return this.opts.map.getZoom()},this.getSize=function(){var a=this.opts.map.getSize();return{width:a.getWidth(),height:a.getHeight()}},this.clearMap=function(){c=[],this.thumbPhotoIds=[],this.opts.map&&this.opts.map.clearMap()},this.setAuto=function(a){this.opts.auto=a}},a.cnmap.PanoramioLayer.prototype=new a.cnmap.Panoramio,a.cnmap.PanoramioLayer});