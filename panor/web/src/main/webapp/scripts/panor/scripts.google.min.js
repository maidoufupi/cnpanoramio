"use strict";!function(){function a(a,b,c,d){angular.forEach(b.split(" "),function(b){window.google.maps.event.addListener(c,b,function(c){d.triggerHandler("map-"+b,c),a.$$phase||a.$apply()})})}function b(b,c){e.directive(b,[function(){return{restrict:"A",link:function(d,e,f){d.$watch(f[b],function(b){b&&a(d,c,b,e)})}}}])}function c(a,b){var c,e=[],g=function(a,b){b=angular.isFunction(b)?b():null==b?"":b,e[e.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(angular.isArray(a)||a.jquery&&!angular.isObject(a))angular.forEach(a,function(){g(this.name,this.value)});else for(c in a)d(c,a[c],b,g);return e.join("&").replace(f,"+")}function d(a,b,c,e){var f;if(angular.isArray(b))angular.forEach(b,function(b,f){c||rbracket.test(a)?e(a,b):d(a+"["+("object"==typeof b?f:"")+"]",b,c,e)});else if(!c&&angular.isObject(b))for(f in b)d(a+"["+f+"]",b[f],c,e);else e(a,b)}var e=angular.module("ui.map",["ui.event"]);e.value("uiMapConfig",{}).directive("uiMap",["uiMapConfig","$parse","$timeout",function(b,c,d){var e="bounds_changed center_changed click dblclick drag dragend dragstart heading_changed idle maptypeid_changed mousemove mouseout mouseover projection_changed resize rightclick tilesloaded tilt_changed zoom_changed",f=b||{};return{restrict:"A",link:function(b,g,h){function i(){if(k.uiMapCache&&window[h.uiMapCache])g.replaceWith(window[h.uiMapCache]),j=window[h.uiMapCache+"Map"];else{k.centerPoint&&k.centerPoint.lat&&k.centerPoint.lng&&(k.center=new google.maps.LatLng(k.centerPoint.lat,k.centerPoint.lng)),j=new window.google.maps.Map(g[0],k);var d=c(h.uiMap);d.assign(b,j),a(b,e,j,g)}}var j,k=angular.extend({},f,b.$eval(h.uiOptions));b.$on("map.loaded",function(a,b){"google"!=b||j||i()}),window.google&&window.google.maps&&window.google.maps.Map&&d(function(){i()},200)}}}]),e.value("uiMapInfoWindowConfig",{}).directive("uiMapInfoWindow",["uiMapInfoWindowConfig","$parse","$compile",function(b,c,d){var e="closeclick content_change domready position_changed zindex_changed",f=b||{};return{link:function(b,g,h){function i(){l||(l=new window.google.maps.InfoWindow(j),k.assign(b,l)),a(b,e,l,g),g.replaceWith("<div></div>");var c=l.open;l.open=function(a,e,f,h,i,j){d(g.contents())(b),c.call(l,a,e,f,h,i,j)}}var j=angular.extend({},f,b.$eval(h.uiOptions));j.content=g[0];var k=c(h.uiMapInfoWindow),l=k(b);b.$on("map.loaded",function(a,b){"google"!=b||l||i()}),window.google&&window.google.maps&&window.google.maps.Map&&i()}}}]),b("uiMapMarker","animation_changed click clickable_changed cursor_changed dblclick drag dragend draggable_changed dragstart flat_changed icon_changed mousedown mouseout mouseover mouseup position_changed rightclick shadow_changed shape_changed title_changed visible_changed zindex_changed"),b("uiMapPolyline","click dblclick mousedown mousemove mouseout mouseover mouseup rightclick"),b("uiMapPolygon","click dblclick mousedown mousemove mouseout mouseover mouseup rightclick"),b("uiMapRectangle","bounds_changed click dblclick mousedown mousemove mouseout mouseover mouseup rightclick"),b("uiMapCircle","center_changed click dblclick mousedown mousemove mouseout mouseover mouseup radius_changed rightclick"),b("uiMapGroundOverlay","click dblclick"),e.provider("uiMapLoadParams",function(){var a={sensor:!0};this.setParams=function(b){a=b},this.$get=function(){return a}}).directive("uiMapAsyncLoad",["$window","$parse","uiMapLoadParams",function(a,b,d){return{restrict:"A",link:function(b,e,f){a.mapgoogleLoadedCallback=function(){b.$broadcast("map.loaded","google")};var g=angular.extend({},d,b.$eval(f.uiMapAsyncLoad));if(g.callback="mapgoogleLoadedCallback",a.google&&a.google.maps)mapgoogleLoadedCallback();else{var h=document.createElement("script");h.type="text/javascript",h.src="http://maps.googleapis.com/maps/api/js?"+c(g),document.body.appendChild(h)}}}}]);var f=/%20/g}(),function(){var a,b,c={}.hasOwnProperty,d=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};a=window,b=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return d(b,a),b.prototype.addLocationHashListener=function(a,b){var c,d;return d=[],c=function(){var a;return a=this.getCenter(),a?b.apply(this,[a.lat(),a.lng(),this.getZoom()]):void 0},d.push(google.maps.event.addListener(a,"idle",c)),d},b.prototype.addToolBar=function(){},b.prototype.setCenter=function(a,b,c){return a.setCenter(new google.maps.LatLng(b,c))},b.prototype.setZoom=function(a,b){return a.setZoom(b)},b.prototype.setZoomAndCenter=function(a,b,c,d){return this.setCenter(a,c,d),this.setZoom(a,Number(b))},b.prototype.zoomIn=function(a){return this.setZoom(a,a.getZoom()+1)},b.prototype.zoomOut=function(a){return this.setZoom(a,a.getZoom()-1)},b.prototype.setBounds=function(a,b,c){return a.fitBounds(new google.maps.LatLngBounds(new google.maps.LatLng(b.lat,b.lng),new google.maps.LatLng(c.lat,c.lng)))},b.prototype.inMapView=function(a,b,c){return c=c||this.opts.map,c.getBounds().contains(new google.maps.LatLng(a,b))},b.prototype.pixelToPoint=function(a,b){var c,d,e,f,g,h,i,j;return i=Math.pow(2,a.getZoom()),c=a.getBounds(),j=c.getSouthWest(),d=c.getNorthEast(),e=new google.maps.LatLng(d.lat(),j.lng()),h=a.getProjection(),f=h.fromLatLngToPoint(e),g=h.fromPointToLatLng(new google.maps.Point((f.x*i+b.x)/i,(f.y*i+b.y)/i)),{lat:g.lat(),lng:g.lng()}},b.prototype.pointToPixel=function(){},b.prototype.addMarker=function(a,b,c){return new google.maps.Marker({map:a,position:new google.maps.LatLng(b,c)})},b.prototype.createDraggableMarker=function(a,b,c){return new google.maps.Marker({map:a,position:new google.maps.LatLng(b,c),draggable:!0})},b.prototype.activeMarker=function(a){return a?(a.setIcon({url:"images/marker.png",size:new google.maps.Size(20,30),anchor:new google.maps.Point(10,30)}),a.setZIndex(2)):void 0},b.prototype.deactiveMarker=function(a){return a?(a.setIcon(null),a.setZIndex(1)):void 0},b.prototype.addMarkerActiveListener=function(a,b){var c;return c=function(){return b.apply(a,[])},google.maps.event.addListener(a,"click",c),google.maps.event.addListener(a,"dragend",c),google.maps.event.addListener(a,"rightclick",c)},b.prototype.addDragendListener=function(a,b){return google.maps.event.addListener(a,"dragend",function(c){return b.apply(a,[c.latLng.lat(),c.latLng.lng()])})},b.prototype.removeMarker=function(a){return a.setMap(null)},b.prototype.addMapClickListener=function(a,b){return google.maps.event.addListener(a,"click",function(c){return b.apply(a,[c.latLng.lat(),c.latLng.lng()])})},b.prototype.setPosition=function(a,b,c){return a.setPosition(new google.maps.LatLng(b,c))},b.prototype.setMap=function(a,b){return a.setMap(b)},b}(window.cnmap.IMapEventListener),b.factory=function(){return new cnmap.MapEventListener},window.cnmap=window.cnmap||{},window.cnmap.MapEventListener=b}.call(this),function(){var a,b,c={}.hasOwnProperty,d=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};a=window,b=function(b){function c(a){this.map=a}return d(c,b),c.prototype.init=function(b,c){return this.geocoder=new a.google.maps.Geocoder,c?c.apply(this.geocoder,[this.geocoder]):void 0},c.prototype.getAddress=function(b,c,d){return this.geocoder||this.init(),this.geocoder.geocode({location:new a.google.maps.LatLng(b,c)},function(a){return a?d.apply(void 0,[a.address]):void 0})},c.prototype.getAddrPois=function(b,c){var d;return d=jQuery.Deferred(),this.geocoder.geocode({location:new a.google.maps.LatLng(b,c)},function(a){var b;return console.log(a),b={},a&&$.each(a,function(a,c){var d;return d=c.formatted_address,b[d]={poiweight:1,location:c.geometry.location}}),a&&a[0]?d.resolve(b,a[0].formatted_address):d.reject("no result")}),d.promise()},c.prototype.getLocation=function(a,b){return this.geocoder||this.init(),this.geocoder.geocode({address:a},function(a){return a?b.apply(void 0,[a]):void 0})},c.prototype.getLocPois=function(a){var b;return b=jQuery.Deferred(),this.geocoder||this.init(),this.geocoder.geocode({address:a},function(c){var d,e,f,g;if(d=[],c)for(f=0,g=c.length;g>f;f++)e=c[f],a={address:e.formatted_address,location:{lat:e.geometry.location.lat(),lng:e.geometry.location.lng()},similarity:1},e.geometry.bounds&&(a.bounds={sw:{lat:e.geometry.bounds.getSouthWest().lat(),lng:e.geometry.bounds.getSouthWest().lng()},ne:{lat:e.geometry.bounds.getNorthEast().lat(),lng:e.geometry.bounds.getNorthEast().lng()}}),d.push(a);return b.resolve(d)}),b.promise()},c.prototype.translate=function(){},c}(window.cnmap.IMapService),b.factory=function(){return new window.cnmap.MapService},window.cnmap=window.cnmap||{},window.cnmap.MapService=b}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};a=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.createPoint=function(a){return new google.maps.LatLng(a.point.lat,a.point.lng)},b.prototype.createMarker=function(a){var b,c;return c=this,b=new google.maps.Marker({map:this.map,position:this.createPoint(a),icon:this.getMarkerImage(a)}),b.photo=a,this.opts.clickable&&google.maps.event.addListener(b,"click",function(){return jQuery(c).trigger("data_clicked",[this.photo.id])}),a.marker=b,this.labels.push(b),b},b.prototype.createPolyline=function(){return new google.maps.Polyline({map:this.map,path:point,strokeWeight:2})},b.prototype.setPolylinePath=function(a,b){return a.setPath(b)},b.prototype.removeMarker=function(a){return a.marker?(a.marker.setMap(null),delete a.marker):void 0},b.prototype.toggleSpotLine=function(a,b){return a.polyline?a.polyline.setVisible(b):void 0},b.prototype.spotEditable=function(a,b){var c,d,e,f,g,h,i;for(e=this,c=function(c){if(c){if(c.setDraggable(e.opts.editable&&b),e.opts.editable&&b)return c.dragListener=google.maps.event.addListener(c,"dragend",function(b){return this.photo.oPoint||(this.photo.oPoint=$.extend({},this.photo.point)),this.photo.point.lat=b.latLng.lat(),this.photo.point.lng=b.latLng.lng(),e.updateSpotLine(a),$(e).trigger("spot.edited",[a.id])});if(c.dragListener)return google.maps.event.removeListener(c.dragListener),c.dragListener=null}},h=a.photos,i=[],f=0,g=h.length;g>f;f++)d=h[f],i.push(c(d.marker));return i},b.prototype.cancelSpotEdit=function(a){var b,c,d,e,f,g;for(d=this,b=function(a){return a.oPoint&&(a.point=a.oPoint,delete a.oPoint),a.marker?a.marker.setPosition(d.createPoint(a)):void 0},g=a.photos,e=0,f=g.length;f>e;e++)c=g[e],b(c);return this.updateSpotLine(a)},b.prototype.clearMap=function(){return $.each(this.labels,function(a,b){return b.setMap(null),b.setVisible(!1)}),this.labels=[]},b}(window.cnmap.ITravelLayer),window.cnmap.TravelLayer=a}.call(this),function(a){"function"==typeof define&&define.amd?define([window,"jquery","Panoramio"],a):a(window,jQuery)}(function(a,b){return a.cnmap=a.cnmap||{},a.cnmap.PanoramioLayer=function(a){var c=[],d=null;this.preZoom=0,this.preBounds=null,this.opts=$.extend({clickable:!0,auto:!0},a),this.opts.map&&this.setMap(this.opts.map),this.setMap=function(a){function b(){if($(c).trigger("map_changed",[c.getBounds(),c.getLevel(),c.getSize()]),c.opts.auto){var a=c.getBounds();if(a){c.getBoundsThumbnails(a,c.getLevel(),c.getSize())}}}a?(this.opts.map=a,d=new google.maps.InfoWindow,google.maps.event.addListener(a,"idle",b),google.maps.event.addListener(a,"dragend",b)):delete this.opts.map;var c=this},this.hideLabel=function(a){c[a]&&(c[a].setVisible(!1),c[a].setMap(null))},this.createMarker=function(a){var e=this.opts.map,f=this,g=c[a.id];g?(g.setVisible(!0),g.setMap(e)):(g=new google.maps.Marker({map:e,position:new google.maps.LatLng(a.point.lat,a.point.lng),icon:this.staticCtx+"/"+a.oss_key+"@!panor-lg"}),g.photoId=a.id,f.opts.clickable&&google.maps.event.addListener(g,"click",function(){f.opts.suppressInfoWindows?(d.setPosition(this.getPosition()),d.setContent(f.getInfoWindowContent(a)),d.open()):b(f).trigger("data_clicked",[this.photoId])}),c[a.id]=g)},this.setOptions=function(a){this.opts=a},this.trigger=function(){this.opts.map&&google.maps.event.trigger(this.opts.map,"dragend")},this.center_changed=function(){},this.getBounds=function(){var a=this.opts.map.getBounds();return a?{ne:{lat:a.getNorthEast().lat(),lng:a.getNorthEast().lng()},sw:{lat:a.getSouthWest().lat(),lng:a.getSouthWest().lng()}}:void 0},this.getLevel=function(){return this.opts.map.getZoom()},this.getSize=function(){var a=this.opts.map.getDiv();return{width:b(a).width(),height:b(a).height()}},this.clearMap=function(){$.each(c,function(a,b){b&&b.setMap(null)}),c=[],this.thumbPhotoIds=[]},this.setAuto=function(a){this.opts.auto=a}},a.cnmap.PanoramioLayer.prototype=new a.cnmap.Panoramio,a.cnmap.PanoramioLayer});