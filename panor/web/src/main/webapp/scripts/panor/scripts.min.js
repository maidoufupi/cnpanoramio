(function(){var a;a=function(){function a(){}return a.prototype.trigger=function(){},a}(),window.ponm=window.ponm||{},window.ponm.IMapEvent=a}).call(this),function(){var a;a=function(){function a(){}return a.prototype.opts={map:null},a.prototype.addLocationHashListener=function(){},a.prototype.removeListener=function(){},a.prototype.addToolBar=function(){},a.prototype.setCenter=function(){},a.prototype.setZoom=function(){},a.prototype.setZoomAndCenter=function(){},a.prototype.setBounds=function(){},a.prototype.clearMap=function(){},a.prototype.inMapView=function(){},a.prototype.addMarker=function(){},a.prototype.createDraggableMarker=function(){},a.prototype.activeMarker=function(){},a.prototype.deactiveMarker=function(){},a.prototype.addMarkerActiveListener=function(){},a.prototype.addDragendListener=function(){},a.prototype.removeMarker=function(){},a.prototype.addMapClickListener=function(){},a.prototype.setPosition=function(){},a.prototype.setMap=function(){},a}(),window.cnmap=window.cnmap||{},window.cnmap.IMapEventListener=a}.call(this),function(){var a;a=function(){function a(){}return a.prototype.map=void 0,a.prototype.init=function(){},a.prototype.getAddress=function(){},a.prototype.getAddrPois=function(){},a.prototype.getLocation=function(){},a.prototype.getLocPois=function(){},a}(),window.cnmap=window.cnmap||{},window.cnmap.IMapService=a}.call(this),function(){var a,b;a=function(){function a(a){var b;this.opts=a,this.opts&&(b=this.opts,this.ctx=b.ctx,this.staticCtx=b.staticCtx,this.map=b.map,this.travel=b.travel),this.mapEventListener=window.cnmap.MapEventListener.factory()}return a.prototype.initMap=function(){},a.prototype.calcSpotTime=function(){var a,b,c,d,e,f,g,h;if(this.travel){for(g=this.travel.spots,c=0,e=g.length;e>c;c++)a=g[c],a.time_start&&(a.spotDate=new Date(a.time_start)),a.spotDate&&(!b||b>a.spotDate)&&(b=a.spotDate);for(this.travel.time_start=b,h=this.travel.spots,d=0,f=h.length;f>d;d++)a=h[d],a.spotDate&&(a.day=Math.ceil((a.spotDate-b)/864e5)+1);if(this.travel.spots.sort(function(a,b){return a.day-b.day}),this.travel.spots.length)return this.travel.time_end=this.travel.spots[this.travel.spots.length-1].time_start}},a.prototype.setMap=function(a){return a?(this.map=a,this.initMap()):void 0},a.prototype.setTravel=function(a){var b,c,d,e,f;for(this.travel=a,this.travel.spots.sort(function(a,b){return a.id-b.id}),e=this.travel.spots,f=[],c=0,d=e.length;d>c;c++)b=e[c],f.push(b.photos.sort(function(a,b){return a.date_time-b.date_time}));return f},a.prototype.createLabel=function(){},a.prototype.getLabelContent=function(a){return"<img src='"+this.staticCtx+"/"+a+"@!panor-lg' style='border: 2px solid white; width: 34px; height: 34px;'>"},a.prototype.activePhoto=function(a){return this.mapEventListener.inMapView(a.point.lat,a.point.lng,this.map)?this.mapEventListener.setCenter(this.map,a.point.lat,a.point.lng):(this.mapEventListener.setCenter(this.map,a.point.lat,a.point.lng),this.mapEventListener.setZoom(this.map,18))},a.prototype.createMarker=function(){},a.prototype.activeSpot=function(a){var b,c,d,e,f,g,h,i,j,k,l;if(angular.isObject(a))e=a;else for(k=this.travel.spots,g=0,i=k.length;i>g;g++)if(b=k[g],parseInt(b.id,10)===parseInt(a,10)){e=b;break}if(e.photos[0]&&(f=jQuery.extend({},e.photos[0].point),c=jQuery.extend({},e.photos[0].point)),f&&c){for(l=e.photos,h=0,j=l.length;j>h;h++)d=l[h],d.point.lat<f.lat&&(f.lat=d.point.lat),d.point.lng<f.lng&&(f.lng=d.point.lng),d.point.lat>c.lat&&(c.lat=d.point.lat),d.point.lng>c.lng&&(c.lng=d.point.lng);return this.mapEventListener.setBounds(this.map,f,c)}},a.prototype.clearMap=function(){return this.mapEventListener.clearMap(this.map)},a}(),window.cnmap=null!=(b=window.cnmap)?b:{},window.cnmap.ITravelLayer=a}.call(this),function(){var a,b,c;a=function(a,b,c,d){var e,f,g,h;return e=Math.PI*a/180,f=Math.PI*b/180,g=Math.PI*c/180,h=Math.PI*d/180,6371e3*Math.acos(Math.min(Math.cos(e)*Math.cos(g)*Math.cos(f)*Math.cos(h)+Math.cos(e)*Math.sin(f)*Math.cos(g)*Math.sin(h)+Math.sin(e)*Math.sin(g),1))},window.cnmap=null!=(b=window.cnmap)?b:{},window.cnmap.GPS=null!=(c=window.cnmap.GPS)?c:{},window.cnmap.GPS.distanceInMeter=a}.call(this),function(a){"function"==typeof define&&define.amd?define([window,"jquery"],a):a(window,jQuery)}(function(a,b){a.cnmap=a.cnmap||{},a.cnmap.utils=a.cnmap.utils||{};var c,d;return a.cnmap.utils.getLocalCity=function(a){var c="http://int.dpool.sina.com.cn/iplookup/iplookup.php?format=js";b.getScript(c).done(function(){a.apply(null,[remote_ip_info.city])})},a.cnmap.GPS=a.cnmap.GPS||{},a.cnmap.GPS.convert=function(a){var b;if("string"==typeof a&&a.constructor==String){var c=a.search(/[0-9]+,[0-9]+,[0-9]+\.[0-9]+/);if(-1!==c){var d=a.split(",");b=Number(d[0])+(Number(d[1])+Number(d[2])/60)/60}else if(c=a.search(/[0-9]+°[0-9]+'([0-9]+|[0-9]+\.[0-9]+)"/),-1!==c){var d=a.split("°"),e=Number(d[0]);d=d[1].split("'");var f=Number(d[0]);d=d[1].split('"');var g=Number(d[0]);b=e+(f+g/60)/60}}else if("number"==typeof a&&a.constructor==Number){var e=Math.floor(a),f=Math.floor(60*(a-e)),g=60*(60*(a-e)-f);g=g.toPrecision(6),b=e+"°"+f+"'"+g+'"'}return b},a.cnmap.utils.baidu={geocoder:null,init:function(){this.geocoder=new BMap.Geocoder},convert:function(a,b,c){var d=new BMap.Point(b,a);BMap.Convertor.translate(d,0,c)},getGeoPoint:function(a,b){this.geocoder||this.init(),this.geocoder.getPoint(a,function(a){b.apply(null,a)})}},a.cnmap.utils.qq={geocoder:null,init:function(){this.geocoder=new qq.maps.Geocoder},getAddress:function(a,b,c){this.geocoder||this.init();var d=new qq.maps.LatLng(a,b);this.geocoder.setComplete(c),this.geocoder.getAddress(d)},getLocation:function(a,b){this.geocoder||this.init(),this.geocoder.setComplete(b),this.geocoder.getLocation(a)}},a.cnmap.utils.gaode={map:null,init:function(a){this.map.plugin(["AMap.Geocoder"],function(){c=new AMap.Geocoder({radius:1e3,extensions:"all"}),a&&a.apply(c,[c])})},getAddress:function(a,b,e){if(c){var f=new AMap.LngLat(b,a);d&&AMap.event.removeListener(d),d=AMap.event.addListener(c,"complete",e),c.getAddress(f)}else this.init(function(c){var f=new AMap.LngLat(b,a);d&&AMap.event.removeListener(d),d=AMap.event.addListener(c,"complete",e),c.getAddress(f)})},getLocation:function(a,b){c||this.init(),d&&AMap.event.removeListener(d),d=AMap.event.addListener(c,"complete",b),c.getLocation(a)}},a.cnmap.utils.compareArray=function(a,c,d){if(a&&c){var e=b.unique(b.merge(b.merge([],a),c));b.each(e,function(e,f){b.inArray(f,a)>-1?b.inArray(f,c)>-1?d.apply(f,[null,f,null]):d.apply(f,[f,null,null]):b.inArray(f,c)>-1&&d.apply(f,[null,null,f])})}},a.cnmap}),function(a){"function"==typeof define&&define.amd?define([window,"jquery","cnmap"],a):a(window,jQuery)}(function(a,b){return a.cnmap=a.cnmap||{},a.cnmap.Panoramio=function(a){var c;this.opts=a||{},this.thumbPhotoIds=[],this.getBoundsThumbnails=function(a,d,e){var f=(this.clearVisible,this.setVisible,{nelat:a.ne.lat,nelng:a.ne.lng,swlat:a.sw.lat,swlng:a.sw.lng,level:d,vendor:this.opts&&this.opts.mapVendor||"gps",width:e.width,height:e.height});this.opts.latest&&(f.latest=!0),this.opts.userId&&(f.userId=this.opts.userId,this.opts.favorite&&(f.favorite=!!this.opts.favorite)),this.opts.tag&&(f.tag=this.opts.tag);var g=this;c.photo.read(f).done(function(a){if("OK"==a.status&&g.opts.auto){var c=[],d={};b.each(a.photos,function(a,b){c.push(b.id),d[b.id]=b}),cnmap.utils.compareArray(g.thumbPhotoIds,c,function(a,b,c){if(a){g.hideLabel(a);var e=g.thumbPhotoIds.indexOf(a);e>-1&&g.thumbPhotoIds.splice(e,1)}c&&(g.thumbPhotoIds.push(d[c].id),g.createMarker(d[c]))}),b(g).trigger("data_changed",[a.photos])}})},this.hideLabel=function(){},this.createMarker=function(){},this.getLabelContent=function(a){return this.opts.phone?"<img src='"+this.staticCtx+"/"+a+"@!panor-lg' style='border: 2px solid white; width: 34px; height: 34px;'>":"<img src='"+this.staticCtx+"/"+a+"@!panor-lg' style='border: 2px solid white; width: 34px; height: 34px;'>"},this.getInfoWindowContent=function(a){var b,c=new Date(a.create_date);return b=c.getFullYear()+"-"+(c.getMonth()+1)+"-"+c.getDate(),'<div class="panoramio-info-window"><div class="header">'+a.address+'</div><div class="body"><a href="'+this.ctx+"/photo/"+a.photo_id+'"><img src="'+this.ctx+"/api/rest/photo/"+a.photo_id+'/2"></a></div><div class="media"><a class="pull-left" href="'+this.ctx+"/user/"+a.user_id+'"><img class="media-object" src="'+this.ctx+"/api/rest/user/"+a.user_id+'/avatar" alt="'+a.username+'"></a><div class="media-body"><h4 class="media-heading">作者：<a href="'+this.ctx+"/user/"+a.user_id+'">'+a.username+"</a></h4>"+b+"</div></div></div>"},this.setMap=function(){},this.initEnv=function(a,b){this.ctx=a;var d=a+"/api/rest/panoramio/";jQuery.support.cors=!0,c=new jQuery.RestClient(d,{}),c.add("photo"),this.staticCtx=b||""},this.setUserId=function(a){this.opts.userId=a},this.getUserId=function(){return this.opts.userId},this.setTag=function(a){this.opts.tag=a},this.getTag=function(){return this.opts.tag},this.setFavorite=function(a){this.opts.favorite=!!a},this.getFavorite=function(){return this.opts.favorite},this.setLatest=function(a){this.opts.latest=!!a},this.getLatest=function(){return this.opts.latest},this.trigger=function(){},this.createPhotosMarker=function(a){this.clearMap();var b=this;jQuery.each(a,function(a,c){b.createMarker(c)})},this.getBounds=function(){},this.getLevel=function(){},this.getSize=function(){},this.clearMap=function(){},this.setAuto=function(a){this.opts.auto=a}},a.cnmap.Panoramio});