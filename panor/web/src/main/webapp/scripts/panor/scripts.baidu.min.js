(function(){var a,b,c={}.hasOwnProperty,d=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};a=window.BMap,b=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return d(b,a),b.prototype.trigger=function(a,b){var c,d,e,f,g,h;for(e=a._e_||{},h=[],f=0,g=e.length;g>f;f++)d=e[f],d._eventName===b&&(c=Array.prototype.slice.call(arguments,2),h.push(d._handler.apply(a,c)));return h},b}(window.ponm.IMapEvent),window.ponm.MapEvent=new b}).call(this),function(){var a,b,c,d={}.hasOwnProperty,e=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};a=window,b=a.BMap,c=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return e(c,a),c.prototype.addLocationHashListener=function(a,b){var c,d;return d=[],c=function(){var a;return a=this.getCenter(),b.apply(this,[a.lat,a.lng,this.getZoom()])},d.push(a.addEventListener("moveend",c)),d.push(a.addEventListener("zoomend",c)),d.push(a.addEventListener("dragend",c)),d},c.prototype.addToolBar=function(a){return a.addControl(new b.NavigationControl),a.addControl(new b.ScaleControl),a.addControl(new b.OverviewMapControl),a.addControl(new b.MapTypeControl)},c.prototype.setCenter=function(a,c,d){return a.setCenter(new b.Point(d,c))},c.prototype.setZoom=function(a,b){return a.setZoom(b)},c.prototype.setZoomAndCenter=function(a,c,d,e){var f;return f=new b.Point(e,d),a.centerAndZoom(f,c)},c.prototype.setBounds=function(a,c,d){return a.setViewport([new b.Point(c.lng,c.lat),new b.Point(d.lng,d.lat)])},c.prototype.inMapView=function(a,c,d){return d=d||this.opts.map,d.getBounds().containsPoint(new b.Point(c,a))},c.prototype.addMarker=function(a,c,d){return a.addOverlay(new b.Marker(new b.Point(d,c)))},c.prototype.createDraggableMarker=function(a,c,d){var e;return e=new b.Marker(new b.Point(d,c),{enableDragging:!0}),a.addOverlay(e),e},c.prototype.activeMarker=function(a){return a?a.setIcon(new b.Icon("images/marker.png",new b.Size(20,30))):void 0},c.prototype.deactiveMarker=function(a){return a?a.setIcon(""):void 0},c.prototype.addMarkerActiveListener=function(a,b){var c;return a.addEventListener("click",c),a.addEventListener("dragend",c),a.addEventListener("rightclick",c),c=function(){return b.apply(a,[])}},c.prototype.addDragendListener=function(a,b){return a.addEventListener("dragend",function(c){return b.apply(a,[c.point.lat,c.point.lng])})},c.prototype.addMapClickListener=function(a,b){return a.addEventListener("click",function(c){return b.apply(a,[c.point.lat,c.point.lng])})},c.prototype.setPosition=function(a,c,d){return a.setPosition(new b.Point(d,c))},c.prototype.setMap=function(a,b){return b.addOverlay(a)},c}(window.cnmap.IMapEventListener),c.factory=function(){return new cnmap.MapEventListener},window.cnmap=window.cnmap||{},window.cnmap.MapEventListener=c}.call(this),function(){var a,b,c,d={}.hasOwnProperty,e=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};a=window,b=a.BMap,c=function(a){function c(a){this.map=a}return e(c,a),c.prototype.init=function(a,c){return this.geocoder=new b.Geocoder,c?c.apply(this.geocoder,[this.geocoder]):void 0},c.prototype.getAddress=function(a,c,d){return this.geocoder||this.init(),this.geocoder.getLocation(new b.Point(c,a),function(a){return a?d.apply(void 0,[a.address]):void 0})},c.prototype.getAddrPois=function(a,c){var d;return d=jQuery.Deferred(),this.geocoder.getLocation(new b.Point(c,a),function(a){var b;return console.log(a),b={},a&&$.each(a.surroundingPois,function(a,c){var d;return d=c.title?c.address+" / "+c.title:c.address,b[d]={poiweight:1,location:c.point}}),d.resolve(b,a.address)}),d.promise()},c.prototype.getLocation=function(a,b){return this.geocoder||this.init(),this.geocoder.getPoint(a,function(a){return a?b.apply(void 0,[a]):void 0})},c.prototype.getLocPois=function(a){var b;return b=jQuery.Deferred(),this.geocoder||this.init(),this.geocoder.getPoint(a,function(c){var d;return d=[],c&&d.push({address:a,location:c,similarity:1}),b.resolve(d)}),b.promise()},c}(window.cnmap.IMapService),c.factory=function(){return new window.cnmap.MapService},window.cnmap=window.cnmap||{},window.cnmap.MapService=c}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};a=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.initMap=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;if(a&&(this.map=a),this.calcSpotTime(),c=[],this.travel){for(k=this.travel.spots,n=[],e=0,h=k.length;h>e;e++){for(d=k[e],l=d.photos,f=0,i=l.length;i>f;f++)b=l[f],this.createLabel(b);for(c=[],m=d.photos,g=0,j=m.length;j>g;g++)b=m[g],c.push(this.createPoint(b));n.push(this.map.addOverlay(new BMap.Polyline(c,{map:this.map,strokeStyle:"dashed"})))}return n}},b.prototype.createPoint=function(a){return new BMap.Point(a.point.lng,a.point.lat)},b.prototype.createLabel=function(a){var b,c;return c=this,b=new BMap.Label,b.setContent(this.getLabelContent(a.oss_key)),b.setPosition(this.createPoint(a)),b.setStyle({border:0,padding:0}),b.photoId=a.id,this.map.addOverlay(b),this.opts.clickable?b.addEventListener("click",function(){return jQuery(c).trigger("data_clicked",[this.photoId])}):void 0},b}(window.cnmap.ITravelLayer),window.cnmap.TravelLayer=a}.call(this),function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(window)}(function(a){return a.cnmap=a.cnmap||{},a.cnmap.PanoramioLayer=function(a){var b=[],c=(new BMap.Marker,new BMap.InfoWindow(""));c.enableCloseOnClick(),this.preZoom=0,this.preBounds=null,this.opts=$.extend({clickable:!0,auto:!0,mapVendor:"baidu"},a),this.opts.map&&this.setMap(this.opts.map),this.getMap=function(){return this.opts.map},this.setMap=function(b){function d(){e.loadPhotos()}b?(this.opts.map=b,b.addOverlay(c),b.addEventListener("load",d),b.addEventListener("tilesloaded",d),b.addEventListener("zoomend",d),b.addEventListener("moveend",d)):(a.map=null,b.clearOverlays(),b.removeEventListener("tilesloaded"),b.removeEventListener("zoomend"),b.removeEventListener("moveend"));var e=this},this.loadPhotos=function(){var a=this,b=this.opts.map;if($(a).trigger("map_changed",[a.getBounds(),a.getLevel(),a.getSize()]),a.opts.auto){b.getBounds(),b.getSize(),a.getBoundsThumbnails(a.getBounds(),a.getLevel(),a.getSize())}},this.hideLabel=function(a){b[a]&&this.opts.map.removeOverlay(b[a])},this.createMarker=function(d){var e=this.opts.map,f=this,g=b[d.id];g?e.addOverlay(g):(g=new BMap.Label,g.setContent(f.getLabelContent(d.oss_key)),g.setPosition(new BMap.Point(d.point.lng,d.point.lat)),g.photoId=d.id,g.setZIndex(1),g.setStyle({border:0,padding:"0",fontSize:"12px",lineHeight:"20px",fontFamily:"微软雅黑"}),f.opts.clickable&&g.addEventListener("click",function(){a.suppressInfoWindows?c.isOpen()?c.close():(c.setContent(panoramio.getInfoWindowContent(this.photoId)),e.openInfoWindow(c,this.getPosition())):$(f).trigger("data_clicked",[this.photoId])}),b[d.id]=g,e.addOverlay(g))},this.setOptions=function(b){a=b},this.trigger=function(){this.opts.map&&this.loadPhotos()},this.getBounds=function(){var a=this.opts.map.getBounds();return{ne:{lat:a.getNorthEast().lat,lng:a.getNorthEast().lng},sw:{lat:a.getSouthWest().lat,lng:a.getSouthWest().lng}}},this.getLevel=function(){return this.opts.map.getZoom()},this.getSize=function(){return this.opts.map.getSize()},this.clearMap=function(){b=[],this.thumbPhotoIds=[],this.opts.map&&this.opts.map.clearOverlays()}},a.cnmap.PanoramioLayer.prototype=new a.cnmap.Panoramio,a.cnmap.PanoramioLayer});