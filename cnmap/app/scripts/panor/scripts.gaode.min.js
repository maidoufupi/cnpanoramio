"use strict";!function(a){"function"==typeof define&&define.amd?define([window,"jquery","cnmap"],a):a(window,jQuery)}(function(a){return a.cnmap.MapEventListener=function(b){this.opts=b||this.opts,this.addLocationHashListener=function(b,c){function d(){var a=b.getCenter();c.apply(this,[a.lat,a.lng,b.getZoom()])}a.AMap.event.addListener(b,"zoomend",d),a.AMap.event.addListener(b,"moveend",d)},this.addToolBar=function(a){a.plugin(["AMap.ToolBar"],function(){var b=new AMap.ToolBar;a.addControl(b)})},this.setCenter=function(a,b,c){var d=new AMap.LngLat(c,b);a.setCenter(d)},this.setZoom=function(a,b){a.setZoom(b)},this.setBounds=function(a,b,c){a.setBounds(new AMap.Bounds(new AMap.LngLat(b.lng,b.lat),new AMap.LngLat(c.lng,c.lat)))},this.clearMap=function(a){return a&&a.clearMap()},this.inMapView=function(a,b,c){c=c||this.opts.map;var d=new AMap.LngLat(b,a);return c.getBounds().contains(d)},this.addMarker=function(a,b,c){return new AMap.Marker({map:a,position:new AMap.LngLat(c,b)})},this.createDraggableMarker=function(a,b,c){return new AMap.Marker({draggable:!0,map:a,position:new AMap.LngLat(c,b)})},this.activeMarker=function(a){a&&(a.setzIndex(2),a.setIcon("images/marker.png"))},this.deactiveMarker=function(a){a&&(a.setzIndex(1),a.setIcon(""))},this.addMarkerActiveListener=function(a,b){function c(){b.apply(a,[])}AMap.event.addListener(a,"click",c),AMap.event.addListener(a,"touchstart",c),AMap.event.addListener(a,"dragend",c)},this.addDragendListener=function(a,b){AMap.event.addListener(a,"dragend",function(c){b.apply(a,[c.lnglat.lat,c.lnglat.lng])})},this.addMapClickListener=function(a,b){AMap.event.addListener(a,"click",function(c){var d=c.lnglat;b.apply(a,[d.lat,d.lng])})},this.setPosition=function(a,b,c){var d=new AMap.LngLat(c,b);a.setPosition(d)},this.setMap=function(a,b){a.setMap(b),a.show()}},a.cnmap.MapEventListener.prototype=a.cnmap.IMapEventListener,a.cnmap.MapEventListener.factory=function(){return new a.cnmap.MapEventListener},a.cnmap.MapEventListener}),function(a){"function"==typeof define&&define.amd?define([window,"jquery","cnmap"],a):a(window,jQuery)}(function(a){return a.cnmap.MapService=function(a){var b={"国家":3,"省":7,"市":9,"区县":11,"乡镇":13,"村庄":16,"热点商圈":16,"小区":18,"兴趣点":18,"门牌号":19,"道路":17,"道路交叉路口":18,"公交站台、地铁站":18};this.map=a||this.map;var c;this.init=function(a,b){a&&(a instanceof Function?b=a:this.map=a),this.map.plugin(["AMap.Geocoder"],function(){c=new AMap.Geocoder({radius:1e3,extensions:"all"}),b&&b.apply(c,[c])})},this.getAddress=function(a,b,d){function e(){AMap.event.addListenerOnce(c,"complete",function(a){"OK"==a.info&&d.apply(void 0,[a.regeocode.formattedAddress])}),c.getAddress(f)}var f=new AMap.LngLat(b,a);c?e():this.init(function(){e()})},this.getAddrPois=function(a,b,d){function e(){AMap.event.addListenerOnce(c,"complete",function(a){if("OK"==a.info){var b=a.regeocode,c={},e=b.addressComponent.province+b.addressComponent.district+b.addressComponent.city+b.addressComponent.township;angular.forEach(b.pois,function(a){c[e+a.name]={poiweight:a.poiweight,location:a.location}}),d.apply(void 0,[c,b.formattedAddress])}}),c.getAddress(f)}var f=new AMap.LngLat(b,a);c?e():this.init(function(){e()})},this.getLocation=function(a,b){function d(){AMap.event.addListenerOnce(c,"complete",function(a){"OK"==a.info&&b.apply(void 0,[a])}),c.getLocation(a)}c?d():this.init(function(){d()})},this.getLocPois=function(a,d){function e(){AMap.event.addListenerOnce(c,"complete",function(a){var c=[];"OK"==a.info&&angular.forEach(a.geocodes,function(a){c.push({address:a.formattedAddress,location:a.location,similarity:1,zoom:b[a.level]||4})}),d.apply(void 0,[c])}),c.getLocation(a)}c?e():this.init(function(){e()})}},a.cnmap.MapService.prototype=a.cnmap.IMapService,a.cnmap.MapService.factory=function(){return new a.cnmap.MapService},a.cnmap.MapService}),function(){var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};a=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.prototype.initMap=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;if(a&&(this.map=a),this.mapEventListener.setMap(this.marker,this.map),this.calcSpotTime(),c=[],this.travel){for(k=this.travel.spots,n=[],e=0,h=k.length;h>e;e++){for(d=k[e],l=d.photos,f=0,i=l.length;i>f;f++)b=l[f],this.createLabel(b);for(c=[],m=d.photos,g=0,j=m.length;j>g;g++)b=m[g],c.push(this.createPoint(b));n.push(new AMap.Polyline({map:this.map,path:c,strokeStyle:"dashed"}))}return n}},b.prototype.createPoint=function(a){return new AMap.LngLat(a.point.lng,a.point.lat)},b.prototype.createLabel=function(a){var b,c;return c=this,b=new AMap.Marker({map:this.map,position:new AMap.LngLat(a.point.lng,a.point.lat),offset:new AMap.Pixel(-15,-15),content:this.getLabelContent(a.oss_key)}),b.photoId=a.id,this.opts.clickable&&AMap.event.addListener(b,"click",function(){return jQuery(c).trigger("data_clicked",[this.photoId])}),b.photoId=a.id,b.setMap(this.map)},b.prototype.createSpot=function(a){var b,c,d,e,f,g;for(c=0,g=a.photos,e=0,f=g.length;f>e;e++)d=g[e],b=window.cnmap.GPS.distanceInMeter(a.center_lat,a.center_lng,d.point.lat,d.point.lng),b>c&&(c=b);return new AMap.Circle({map:this.map,center:new AMap.LngLat(a.center_lng,a.center_lat),radius:c,strokeStyle:"dashed",strokeColor:"#0066FF",strokeOpacity:.2,fillColor:"#0066FF",fillOpacity:.2})},b.prototype.createLine=function(a){var b,c,d;return c=function(){var c,e,f;for(f=[],b=c=0,e=a.length;e>c;b=++c)d=a[b],f.push(function(a){return new AMap.LngLat(a.center_lng,a.center_lat)}(d,b));return f}(),new AMap.Polyline({map:this.map,path:c,strokeStyle:"dashed"})},b.prototype.createMarker=function(){return window.AMap?new AMap.Marker({map:this.map,icon:"images/marker.png",animation:"AMAP_ANIMATION_BOUNCE"}):void 0},b}(window.cnmap.ITravelLayer),window.cnmap.TravelLayer=a}.call(this),function(a){"function"==typeof define&&define.amd?define([window,"jquery","Panoramio"],a):a(window,jQuery)}(function(a,b){return a.cnmap=a.cnmap||{},a.cnmap.PanoramioLayer=function(a){var c=[],d=[],e=new AMap.InfoWindow({isCustom:!1,closeWhenClickMap:!0});this.preZoom=0,this.preBounds=null,this.opts=b.extend({clickable:!0,auto:!0},a),this.opts.map&&this.setMap(this.opts.map),this.setMap=function(e){function f(){if(b(g).trigger("map_changed",[g.getBounds(),g.getLevel(),g.getSize()]),g.opts.auto){e.getBounds(),e.getSize(),g.getBoundsThumbnails(g.getBounds(),g.getLevel(),g.getSize(),function(a){var e=[],f={};for(var h in a)e.push(a[h].id),f[a[h].id]=a[h];cnmap.utils.compareArray(d,e,function(a,b,e){if(a){c[a]&&c[a].setMap(null);var h=d.indexOf(a);h>-1&&d.splice(h,1)}e&&g.createMarker(f[e])}),b(g).trigger("data_changed",[a])})}}e?(this.opts.map=e,AMap.event.addListener(e,"complete",f),AMap.event.addListener(e,"zoomend",function(){e.getZoom()!=this.preZoom&&(this.preZoom=e.getZoom(),f())}),AMap.event.addListener(e,"moveend",f)):(a.map,e.clearMap(),clearVisible());var g=this},this.createMarker=function(f){var g=this.opts.map,h=this;if(d.push(f.id),c[f.id])c[f.id].setMap(g);else{var i=new AMap.Marker({map:g,position:new AMap.LngLat(f.point.lng,f.point.lat),offset:new AMap.Pixel(0,0),content:h.getLabelContent(f.oss_key)});i.photoId=f.id,h.opts.clickable&&AMap.event.addListener(i,"click",function(){a.suppressInfoWindows?e.getIsOpen()?e.close():(e.setContent(h.getInfoWindowContent(photos[this.photoId])),e.open(g,this.getPosition())):b(h).trigger("data_clicked",[this.photoId])}),c[f.id]=i,i.setMap(g)}},this.createPhotosMarker=function(a){this.clearMap(),c=[],d=[];var b=this;jQuery.each(a,function(a,c){b.createMarker(c)})},this.setOptions=function(b){a=b},this.trigger=function(){this.opts.map&&AMap.event.trigger(this.opts.map,"moveend")},this.center_changed=function(){},this.getBounds=function(){var a=this.opts.map.getBounds();return{ne:{lat:a.getNorthEast().lat,lng:a.getNorthEast().lng},sw:{lat:a.getSouthWest().lat,lng:a.getSouthWest().lng}}},this.getLevel=function(){return this.opts.map.getZoom()},this.getSize=function(){var a=this.opts.map.getSize();return{width:a.getWidth(),height:a.getHeight()}},this.clearMap=function(){this.opts.map.clearMap()},this.setAuto=function(a){this.opts.auto=a}},a.cnmap.PanoramioLayer.prototype=new a.cnmap.Panoramio,a.cnmap.PanoramioLayer});