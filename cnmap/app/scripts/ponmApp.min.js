"use strict";angular.module("ponmApp",["ngCookies","ngResource","ngSanitize","ngRoute","ponmApp.services","ponmApp.directives","ponmApp.controllers"]).config(["$routeProvider","$logProvider","$sceDelegateProvider",function(a,b,c){b.debugEnabled=!0,c.resourceUrlWhitelist(["self","http://bdimg.share.baidu.com/**"])}]).run(["$rootScope","$window",function(a,b){a.user=b.login?{id:b.userId,loggedIn:!0}:{loggedIn:!1}}]),angular.module("ponmApp.controllers",["ponmApp","xeditable","ui.map"]).run(["editableOptions","editableThemes",function(a,b){a.theme="bs3",b.bs3.submitTpl='<button type="submit" class="btn btn-info">提交</button>',b.bs3.cancelTpl='<button type="button" class="btn btn-default" ng-click="$form.$cancel()">取消</button>'}]),angular.module("ponmApp.directives",["ngResource"]).directive("contenteditable",["$parse",function(){return{require:"ngModel",scope:{ngModel:"@"},link:function(a,b,c,d){function e(){b.css("color","grey"),b.html(b.placeholder)}function f(){b.css("color",""),b.html("")}b.placeholder=c.placeHolder,b.css("cursor","pointer"),b.on("blur",function(){c.multipleLine?(b.css("overflow","hidden"),a.$apply(function(){if(b.placeholder!=b.html()){var a="",c=b.contents();angular.forEach(c,function(b){b instanceof String?(a&&(a+="\n"),a+=b):""!=b.textContent&&(a&&(a+="\n"),a+=b.textContent)}),d.$setViewValue(a)}d.$render()})):a.$apply(function(){b.placeholder!=b.html()&&d.$setViewValue(b.html()),d.$render()})}),b.on("focus",function(){a.$apply(function(){b.placeholder==b.html()&&f()}),c.multipleLine}),d.$render=function(){d.$viewValue?b.html(d.$viewValue):e()},d.$render(),c.editable&&!a.$eval(c.editable)&&(b.on("input",function(a){b.html(d.$viewValue),a.preventDefault(),a.stopPropagation()}),b.on("keypress keydown keyup onchange",function(a){a.preventDefault(),a.stopPropagation()})),c.multipleLine||b.on("keypress",function(a){13==a.keyCode&&(a.preventDefault(),a.stopPropagation())}),b.on("mouseenter",function(){d.$render(),a.$apply(function(){a.mouseEnter=!0})}),b.on("mouseleave",function(){a.$apply(function(){a.mouseEnter=!1})})}}}]).directive("itemPicker",["$parse","$log",function(a,b){return{restrict:"EA",require:"ngModel",scope:{loadData:"&",newData:"&",itemValueName:"@"},templateUrl:"views/tagPickerView.html",link:function(a,c,d,e){function f(){if(a.loadData){var c;(c=a.loadData())?(a.loadingItems=!0,h=c(function(b){h=b,g(),a.loadingItems=!1}),g()):b.error("load-data function "+d.loadData+" is not defined!")}else b.error("load-data attribute is not defined!")}function g(){a.items=[],angular.isArray(h)&&h.length&&(a.loadingItems=!1),angular.forEach(h,function(b,c){a.items.push(angular.isObject(b)?{value:b[a.itemValueName],$key:c}:{value:b,$key:c})})}a.itemValueName=a.itemValueName||"value";var h=null,i=[],j=c.find("div.dropdown-toggle");j.on("focus",function(){h||(f(),a.$apply(function(){return a.items}))}),angular.element(".dropdown-menu").on("click",function(a){a.preventDefault(),a.stopPropagation()}),a.setItem=function(b){if(a.multipleSelect){i=[];var c=[];b.$active=!b.$active,a.item="",angular.forEach(a.items,function(a){a.$active&&(i.push(h[a.$key]),c.push(a.value))}),a.item=c.join(d.multipleSelect||",")}else{if(b.$active)return;a.item=b.value,angular.forEach(a.items,function(a){a.$active=!1}),b.$active=!0,i=h[b.$key]}a.originalItemValue=a.item,e.$setViewValue(i)},a.clearItems=function(){a.originalItemValue="",a.item="",a.items=null},a.$watch("item",function(b){b!=a.originalItemValue&&angular.forEach(a.items,function(a){a.$active=!1})}),a.createData=function(b){b&&a.newData&&(h=a.newData()(b,function(b){h=b,a.newItem="",g()}))&&(a.newItem="",a.clearItems(),g())},a.multipleSelect=void 0===d.multipleSelect||"false"===d.multipleSelect?!1:!0}}}]),angular.module("ponmApp.services",["ngResource"]).factory("CommentService",["$window","$resource",function(a,b){return b(a.apirest+"/comment/:commentId/:type",{commentId:"@id"},{modify:{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Accept:"application/json"}},like:{method:"GET",params:{type:"like"}},unLike:{method:"DELETE",params:{type:"like"}}})}]).factory("UserPhoto",["$window","$resource",function(a,b){return b(a.apirest+"/user/:userId/photos/:type/:tag/:pageSize/:pageNo",{userId:"@id"},{query:{method:"GET",isArray:!0},getByTag:{method:"GET",params:{type:"tag"}}})}]).factory("UserService",["$window","$resource",function(a,b){return b(a.apirest+"/user/:userId/:type/:value",{userId:"@id"},{getMe:{method:"GET"},getOpenInfo:{method:"GET",params:{type:"openinfo"}},getSettings:{method:"GET",params:{type:"settings"}},updateSettings:{method:"POST",params:{type:"settings"}},getTravels:{method:"GET",params:{type:"travel"}},getTags:{method:"GET",params:{type:"tag"}},createTag:{method:"GET",params:{type:"tag"}}})}]).factory("PhotoService",["$window","$resource",function(a,b){return b(a.apirest+"/photo/:photoId/:type/:pageSize/:pageNo",{photoId:"@id"},{getCameraInfo:{method:"GET",params:{type:"camerainfo"}},"delete":{method:"DELETE"},tag:{method:"POST",params:{type:"tag"}},updateProperties:{method:"POST",params:{type:"properties"}},getPhoto:{method:"GET"},getGPSInfo:{method:"GET",params:{type:"gps"}},favorite:{method:"PUT",params:{type:"favorite"}},removeFavorite:{method:"DELETE",params:{type:"favorite"}},getComments:{method:"GET",params:{type:"comment"}},like:{method:"GET",params:{type:"like"}},unLike:{method:"DELETE",params:{type:"like"}}})}]).service("GPSConvertService",["$window","$resource",function(a,b){return b(a.apirest+"/gps",{},{convert:{method:"GET",headers:{Accept:"application/json"}}})}]).service("AvatarService",["$window","$resource",function(a,b){return b(a.apirest+"/user/avatar",{},{upload:{method:"POST",headers:{"Content-Type":!1,Accept:"application/json"}}})}]).factory("TravelService",["$window","$resource",function(a,b){return b(a.apirest+"/travel/:travelId/:type/:typeId/:action",{travelId:"@id"},{create:{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Accept:"application/json"}},addPhoto:{method:"POST",params:{type:"photo"},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Accept:"application/json"}},getTravel:{method:"GET",headers:{Accept:"application/json"}},changeTravel:{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Accept:"application/json"}},getSpot:{method:"GET",params:{type:"spot"}},changeSpot:{method:"POST",params:{type:"spot"},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Accept:"application/json"}},createSpot:{method:"POST",params:{type:"spot"}},addSpotPhoto:{method:"POST",params:{type:"spot",action:"photo"},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Accept:"application/json"}},deleteSpot:{method:"DELETE",params:{type:"spot"}},deletePhoto:{method:"DELETE",params:{type:"photo"},headers:{Accept:"application/json"}},like:{method:"GET",params:{type:"like"}},unLike:{method:"DELETE",params:{type:"like"}}})}]).service("LoginUserService",["$window","$resource","$rootScope",function(a,b,c){this.getUserId=function(){return c.user.id}}]).factory("safeApply",[function(){return function(a,b){var c=a.$root.$$phase;"$apply"==c||"$digest"==c?b&&a.$eval(b):b?a.$apply(b):a.$apply()}}]).factory("ponmCtxConfig",["$window","$resource",function(a){return{staticCtx:a.staticCtx||"http://static.photoshows.cn",corsproxyCtx:"http://www.corsproxy.com/static.photoshows.cn",userId:a.userId}}]),angular.module("ponmApp.services").factory("param",["$window",function(){function a(b,c,d,e){var f;if(angular.isArray(c))angular.forEach(c,function(c,f){d||rbracket.test(b)?e(b,c):a(b+"["+("object"==typeof c?f:"")+"]",c,d,e)});else if(d||"object"!==jQuery.type(c))e(b,c);else for(f in c)a(b+"["+f+"]",c[f],d,e)}var b=/%20/g;return function(c,d){var e,f=[],g=function(a,b){b=angular.isFunction(b)?b():null==b?"":b,f[f.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(angular.isArray(c)||c.jquery&&!angular.isObject(c))angular.forEach(c,function(){g(this.name,this.value)});else for(e in c)a(e,c[e],d,g);return f.join("&").replace(b,"+")}}]).factory("deparam",["$window",function(){var a=decodeURIComponent;return function(b,c){var d={},e={"true":!0,"false":!1,"null":null};return angular.forEach(b.replace(/\+/g," ").split("&"),function(b){var f,g=b.split("="),h=a(g[0]),i=d,j=0,k=h.split("]["),l=k.length-1;if(/\[/.test(k[0])&&/\]$/.test(k[l])?(k[l]=k[l].replace(/\]$/,""),k=k.shift().split("[").concat(k),l=k.length-1):l=0,2===g.length)if(f=a(g[1]),c&&(f=f&&!isNaN(f)?+f:"undefined"===f?void 0:void 0!==e[f]?e[f]:f),l)for(;l>=j;j++)h=""===k[j]?i.length:k[j],i=i[h]=l>j?i[h]||(k[j+1]&&isNaN(k[j+1])?{}:[]):f;else angular.isArray(d[h])?d[h].push(f):d[h]=void 0!==d[h]?[d[h],f]:f;else h&&(d[h]=c?void 0:"")}),d}}]),angular.module("ponmApp.services").factory("GeocodeService",["$window","$http","$q",function(a,b,c){var d={"国家":3,"省":7,"市":9,"区县":11,"乡镇":13,"村庄":16,"热点商圈":16,"小区":18,"兴趣点":18,"门牌号":19,"道路":17,"道路交叉路口":18,"公交站台、地铁站":18};return{levelMap:d,geo:function(a,c){return b.get("http://restapi.amap.com/v3/geocode/geo",{params:{address:a,key:"feb4691f59f30a28499c2a6197ba2773"},headers:{"Access-Control-Allow-Headers":"Content-Type, X-Requested-With","Access-Control-Allow-Methods":"GET, POST, PUT, DELETE, OPTIONS","Access-Control-Allow-Origin":"*"}}).then(function(b){"200"==b.status&&b.data&&"OK"==b.data.info&&(angular.forEach(b.data.geocodes,function(a){d[a.level]&&(a.zoom=d[a.level])}),c.apply(void 0,[b.data.geocodes,a]))})},regeo:function(a,c,d){var e="",f=!1;angular.isArray(a)?(f=!0,angular.forEach(a,function(a){var b=a.lng+","+a.lat;e=e?e+"|"+b:b})):angular.isObject(a)&&(e=a.lng+","+a.lat),b.get("http://restapi.amap.com/v3/geocode/regeo",{params:{location:e,batch:f,extensions:d?"all":"base",key:"feb4691f59f30a28499c2a6197ba2773"},headers:{"Access-Control-Allow-Headers":"Content-Type, X-Requested-With","Access-Control-Allow-Methods":"GET, POST, PUT, DELETE, OPTIONS","Access-Control-Allow-Origin":"*"}}).then(function(a){"200"==a.status&&a.data&&"OK"==a.data.info&&(f?c.apply(void 0,[a.data.regeocodes]):c.apply(void 0,[a.data.regeocode]))})},regeoAddresses:function(a,b){var d=c.defer();return this.regeo({lat:a,lng:b},function(a){var b={},c=a.addressComponent.province+a.addressComponent.district+a.addressComponent.city+a.addressComponent.township;angular.forEach(a.pois,function(a){b[c+a.name]={poiweight:a.poiweight,location:a.location}}),d.resolve({address:a.formatted_address,addresses:b})},"all"),d.promise}}}]);