"use strict";angular.module("ponmApp",["ngCookies","ngResource","ngSanitize","ngAnimate","LocalStorageModule","xeditable","ui.router","ui.bootstrap","ponmApp.services","ponmApp.directives","ponmApp.controllers"]).config(["$logProvider","$sceDelegateProvider","uiMapLoadParamsProvider",function(a,b,c){a.debugEnabled=!1,b.resourceUrlWhitelist(["self","http://bdimg.share.baidu.com/**"]),c.setParams("baidu"==window.mapVendor?{v:"2.0",ak:"kp3ODQt4pkpHMW2Yskl2Lwee"}:"qq"==window.mapVendor?{v:"2.0",key:"ZYZBZ-WCCHU-ETAVP-4UZUB-RGLDJ-QDF57"}:"google"==window.mapVendor?{key:"AIzaSyA9e11ZRebw8fHsd1ZIi0FLTXsrSQTc490"}:{v:"1.3",key:"53f7e239ddb8ea62ba552742a233ed1f"})}]).run(["$rootScope","$window",function(a,b){a.user=b.login?{id:b.userId,loggedIn:!0}:{loggedIn:!1}}]),angular.module("ponmApp.controllers",["ngAnimate","ponmApp","xeditable","ui.map","ui.bootstrap"]).run(["editableOptions","editableThemes",function(a,b){a.theme="bs3",b.bs3.submitTpl='<button type="submit" class="btn btn-info">提交</button>',b.bs3.cancelTpl='<button type="button" class="btn btn-default" ng-click="$form.$cancel()">取消</button>'}]),angular.module("ponmApp.directives",["ngResource","ponm.Matchmedia"]).directive("passwordMatch",[function(){return{require:"ngModel",link:function(a,b,c,d){d.$parsers.unshift(function(b){var e=a.$eval(c.passwordMatch);return d.$setValidity("unique",b==e),b}),a.$watch(c.passwordMatch,function(a){var b=d.$viewValue;d.$setValidity("unique",b==a)})}}}]).directive("passwordStrength",[function(){return{replace:!1,restrict:"A",link:function(a,b,c){var d={colors:["#F00","#F90","#FF0","#9F0","#0F0"],mesureStrength:function(a){var b=0,c=/[$-/:-?{-~!"^_`\[\]]/g,d=/[a-z]+/.test(a),e=/[A-Z]+/.test(a),f=/[0-9]+/.test(a),g=c.test(a),h=[d,e,f,g],i=$.grep(h,function(a){return a===!0}).length;return b+=2*a.length+(a.length>=10?1:0),b+=10*i,b=a.length<=6?Math.min(b,10):b,b=1==i?Math.min(b,10):b,b=2==i?Math.min(b,20):b,b=3==i?Math.min(b,40):b},getColor:function(a){var b=0;return b=10>=a?0:20>=a?1:30>=a?2:40>=a?3:4,{idx:b+1,col:this.colors[b]}}};a.$watch(c.passwordStrength,function(a){if(a){var c=d.getColor(d.mesureStrength(a));b.css({display:"inline"}),b.children("li").css({background:"#DDD"});for(var e=0;e<c.idx;e++)angular.element(b.children("li")[e]).css({background:c.col})}else b.css({display:"none"})})},template:'<li class="point"></li><li class="point"></li><li class="point"></li><li class="point"></li><li class="point"></li>'}}]).directive("ngRemoteValidate",["$http","$timeout","$q","$log",function($http,$timeout,$q,$log){var directiveId="ngRemoteValidate";return{restrict:"A",require:"ngModel",link:function(scope,el,attrs,ngModel){var cache={},handleChange,setValidation,addToCache,request,shouldProcess,options={ngRemoteThrottle:400,ngRemoteMethod:"POST"};angular.extend(options,attrs),options.urls="["===options.ngRemoteValidate.charAt(0)?eval(options.ngRemoteValidate):[options.ngRemoteValidate],addToCache=function(a){var b=a[0].data.value;return cache[b]?cache[b]:void(cache[b]=a)},shouldProcess=function(){var a=!1;for(var b in ngModel.$error)if(ngModel.$error[b]&&b!=directiveId){a=!0;break}return!(ngModel.$pristine||a)},setValidation=function(a,b){for(var c=0,d=a.length,e=!0;d>c;c++)if(!a[c].data.isValid){e=!1;break}b||addToCache(a),ngModel.$setValidity(directiveId,e),el.removeClass("ng-processing"),ngModel.$processing=!1},handleChange=function(a){return"undefined"!=typeof a?shouldProcess(a)?cache[a]?setValidation(cache[a],!0):(request&&$timeout.cancel(request),request=$timeout(function(){el.addClass("ng-processing"),ngModel.$processing=!0;var b=[],c=0,d=options.urls.length,e={value:a},f={method:options.ngRemoteMethod};for("POST"==options.ngRemoteMethod?f.data=e:f.params=e;d>c;c++)f.url=options.urls[c],b.push($http(f));$q.all(b).then(setValidation)},options.ngRemoteThrottle),!0):setValidation([{data:{isValid:!0,value:a}}],!0):void 0},scope.$watch(function(){return ngModel.$viewValue},handleChange)}}}]).directive("ngModelValidate",[function(){return{require:"ngModel",scope:{ngModelValidate:"&"},link:function(a,b,c,d){var e=a.ngModelValidate&&a.ngModelValidate();d.$parsers.unshift(function(b){if(e||(e=a.ngModelValidate&&a.ngModelValidate()),e){var c=e(b);return d.$setValidity(c.errorKey,c.isValid),c.isValid?b:void 0}return b})}}}]).directive("resize",["$window",function(a){return function(b){var c=angular.element(a);c.bind("resize",function(){b.$broadcast("window-resize",{height:c.height(),width:c.width()})})}}]),angular.module("ponmApp.services",["ngResource"]).factory("AuthService",["$window","$resource","$cookies","$log","$q","ponmCtxConfig","SettingsService",function(a,b,c,d,e,f,g){function h(a){var b=e.defer();return k.save({type:"check"},{username:a.username,password:a.password},function(a){"OK"==a.status&&b.resolve()},function(a){d.debug(a.data),b.reject(1)}),b.promise}function i(a){var b=e.defer();return l.save({username:a.username,password:a.password}),b.promise}function j(){var a=e.defer();return f.login&&f.userId?a.resolve():k.get({},function(b){"OK"==b.status?(f.userId=b.user.id,f.id=b.user.id,f.username=b.user.username,f.name=b.user.name,f.avatar=b.user.avatar,f.login=!0,d.debug(b.user),a.resolve(),g.get({userId:f.userId},function(a){"OK"==a.status&&(f.settings.autoUpload=a.settings.auto_upload)})):"NO_AUTHORIZE"==b.status&&a.reject(1)}),a.promise}var k=b(f.apirest+"/auth/login/:type"),l=b(f.ctx+"/login/j_spring_security_check");return{loginCheck:h,login:i,checkLogin:j}}]).factory("CommentService",["$window","$resource",function(a,b){return b(a.apirest+"/comment/:commentId/:type",{commentId:"@id"},{modify:{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Accept:"application/json"}},like:{method:"GET",params:{type:"like"}},unLike:{method:"DELETE",params:{type:"like"}}})}]).factory("UserPhoto",["$window","$resource",function(a,b){return b(a.apirest+"/user/:userId/photos/:type/:tag/:pageSize/:pageNo",{userId:"@id"},{query:{method:"GET",isArray:!0},getByTag:{method:"GET",params:{type:"tag"}},getBounds:{method:"GET",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Accept:"application/json"}}})}]).factory("UserService",["$window","$resource",function(a,b){return b(a.apirest+"/user/:userId/:type/:value/:action",{userId:"@id"},{getMe:{method:"GET"},getOpenInfo:{method:"GET",params:{type:"openinfo"}},getSettings:{method:"GET",params:{type:"settings"}},updateSettings:{method:"POST",params:{type:"settings"}},getTravels:{method:"GET",params:{type:"travel"}},getTags:{method:"GET",params:{type:"tag"}},createTag:{method:"GET",params:{type:"tag"}},getRecycleBin:{method:"GET",params:{type:"recycle"}},emptyRecycleBin:{method:"DELETE",params:{type:"recycle"}},removeRecycle:{method:"DELETE",params:{type:"recycle"}},cancelRecycle:{method:"GET",params:{type:"recycle",action:"cancel"}},getMessages:{method:"GET",params:{type:"messages"}},getMyMessages:{method:"GET",params:{type:"mymessages"}},getFollowers:{method:"GET",params:{type:"follower"}},following:{method:"POST",params:{type:"following"}},unFollowing:{method:"DELETE",params:{type:"following"}},getCircles:{method:"GET",params:{type:"circle"}},getFollowSuggested:{method:"GET",params:{type:"follow",value:"suggested"}},getFollowInterested:{method:"GET",params:{type:"follow",value:"interested"}}})}]).factory("SettingsService",["$window","$resource",function(a,b){return b(a.apirest+"/settings/:userId/:type",{userId:"@id"},{changeMapVendor:{method:"POST",params:{type:"map"}},changePassword:{method:"POST",params:{type:"password"}},changeAccount:{method:"POST",params:{type:"account"}},changeUpload:{method:"POST",params:{type:"upload"}}})}]).factory("PhotoService",["$window","$resource",function(a,b){return b(a.apirest+"/photo/:photoId/:type/:pageSize/:pageNo",{photoId:"@id"},{getCameraInfo:{method:"GET",params:{type:"camerainfo"}},"delete":{method:"DELETE"},tag:{method:"POST",params:{type:"tag"}},updateProperties:{method:"POST",params:{type:"properties"}},getPhoto:{method:"GET"},getGPSInfo:{method:"GET",params:{type:"gps"}},favorite:{method:"PUT",params:{type:"favorite"}},removeFavorite:{method:"DELETE",params:{type:"favorite"}},getComments:{method:"GET",params:{type:"comment"}},like:{method:"GET",params:{type:"like"}},unLike:{method:"DELETE",params:{type:"like"}}})}]).service("GPSConvertService",["$window","$resource",function(a,b){return b(a.apirest+"/gps",{},{convert:{method:"GET",headers:{Accept:"application/json"}}})}]).service("AvatarService",["$window","$resource",function(a,b){return b(a.apirest+"/user/avatar",{},{upload:{method:"POST",headers:{"Content-Type":!1,Accept:"application/json"}}})}]).factory("TravelService",["$window","$resource",function(a,b){return b(a.apirest+"/travel/:travelId/:type/:typeId/:action",{travelId:"@id"},{create:{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Accept:"application/json"}},addPhoto:{method:"POST",params:{type:"photo"},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Accept:"application/json"}},getTravel:{method:"GET",headers:{Accept:"application/json"}},changeTravel:{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"}},getSpot:{method:"GET",params:{type:"spot"}},changeSpot:{method:"POST",params:{type:"spot"},headers:{"Content-Type":"application/json",Accept:"application/json"}},createSpot:{method:"POST",params:{type:"spot"}},addSpotPhoto:{method:"POST",params:{type:"spot",action:"photo"},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Accept:"application/json"}},changeSpotPhotoPosition:{method:"POST",params:{type:"spot",action:"position"}},deleteSpot:{method:"DELETE",params:{type:"spot"}},deletePhoto:{method:"DELETE",params:{type:"photo"},headers:{Accept:"application/json"}},like:{method:"GET",params:{type:"like"}},unLike:{method:"DELETE",params:{type:"like"}}})}]).factory("PanoramioService",["$window","$resource",function(a,b){return b(a.apirest+"/panoramio/:action",{id:"@id"},{getLatest:{method:"GET",params:{action:"photo",latest:!0},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Accept:"application/json"}},search:{method:"GET",params:{action:"search",type:"all"},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Accept:"application/json"}}})}]).factory("MessageService",["ponmCtxConfig","$resource",function(a,b){return b(a.apirest+"/message/:id/:type/:value",{id:"@id"},{like:{method:"GET",params:{type:"like"}},unLike:{method:"DELETE",params:{type:"like"}},share:{method:"POST",params:{type:"share"}}})}]).factory("RecycleService",["ponmCtxConfig","$resource",function(a,b){return b(a.apirest+"/recycle/:id/:type/:value",{id:"@id"},{cancel:{method:"GET",params:{type:"cancel"}}})}]).service("LoginUserService",["$window","$resource","$rootScope",function(a,b,c){this.getUserId=function(){return c.user.id}}]).factory("safeApply",[function(){return function(a,b){var c=a.$root&&a.$root.$$phase;"$apply"==c||"$digest"==c?b&&a.$eval(b):b?a.$apply(b):a.$apply()}}]).factory("ponmCtxConfig",["$window","$resource",function(a){return{ctx:a.ctx,staticCtx:a.staticCtx||"http://static.photoshows.cn",corsproxyCtx:a.corsproxyCtx||"http://www.corsproxy.com/static.photoshows.cn",apirest:a.apirest,userId:a.user&&a.user.id,name:a.user&&a.user.name,login:a.login,mapVendor:a.mapVendor,getCoordSS:function(a){return a||(a=this.mapVendor),"qq"==a?"gaode":a},dev:a.dev,settings:{autoUpload:!0}}}]),angular.module("ponmApp.services").factory("GeocodeService",["$window","$http","$q",function(a,b,c){var d={"国家":3,"省":7,"市":9,"区县":11,"乡镇":13,"村庄":16,"热点商圈":16,"小区":18,"兴趣点":18,"门牌号":19,"道路":17,"道路交叉路口":18,"公交站台、地铁站":18};return{levelMap:d,geo:function(a,c){return b.get("http://restapi.amap.com/v3/geocode/geo",{params:{address:a,key:"feb4691f59f30a28499c2a6197ba2773"},headers:{"Access-Control-Allow-Headers":"Content-Type, X-Requested-With","Access-Control-Allow-Methods":"GET, POST, PUT, DELETE, OPTIONS","Access-Control-Allow-Origin":"*"}}).then(function(b){"200"==b.status&&b.data&&"OK"==b.data.info&&(angular.forEach(b.data.geocodes,function(a){d[a.level]&&(a.zoom=d[a.level])}),c.apply(void 0,[b.data.geocodes,a]))})},regeo:function(a,c,d){var e="",f=!1;angular.isArray(a)?(f=!0,angular.forEach(a,function(a){var b=a.lng+","+a.lat;e=e?e+"|"+b:b})):angular.isObject(a)&&(e=a.lng+","+a.lat),b.get("http://restapi.amap.com/v3/geocode/regeo",{params:{location:e,batch:f,extensions:d?"all":"base",key:"feb4691f59f30a28499c2a6197ba2773"},headers:{"Access-Control-Allow-Headers":"Content-Type, X-Requested-With","Access-Control-Allow-Methods":"GET, POST, PUT, DELETE, OPTIONS","Access-Control-Allow-Origin":"*"}}).then(function(a){"200"==a.status&&a.data&&"OK"==a.data.info&&(f?c.apply(void 0,[a.data.regeocodes]):c.apply(void 0,[a.data.regeocode]))})},regeoAddresses:function(a,b){var d=c.defer();return this.regeo({lat:a,lng:b},function(a){var b={},c=a.addressComponent.province+a.addressComponent.district+a.addressComponent.city+a.addressComponent.township;angular.forEach(a.pois,function(a){b[c+a.name]={poiweight:a.poiweight,location:a.location}}),d.resolve({address:a.formatted_address,addresses:b})},"all"),d.promise}}}]),angular.module("ponmApp.services").factory("HashStateManager",["$window","$timeout","jsUtils",function(a,b,c){var d=function(a,b){this.scope=a,this.location=b,this.scope.hashStateObj={},this.hashStateCache={},this.initialized=!1;var d=this;a.$watch(function(){return b.hash()},function(a){d.initialized=!0,d.scope.hashStateObj=c.deparam(a)})};return d.prototype.watch=function(a,b){var c=a.split(" "),d=this;angular.forEach(c,function(a){d.scope.$watch("hashStateObj."+a,function(c){d.hashStateCache[a]!=c&&(b.apply(null,[c]),d.hashStateCache[a]=c)})})},d.prototype.bindingWatch=function(a,c){var d,e=a.split(" "),f=this;angular.forEach(e,function(a){f.scope.$watch("hashStateObj."+a,function(g){f.hashStateCache[a]!=g&&(d&&b.cancel(d),d=b(function(){var a=[];angular.forEach(e,function(b){a.push(f.get(b))}),c.apply(null,a)},0),f.hashStateCache[a]=g)})})},d.prototype.get=function(a){return this.scope.hashStateObj[a]},d.prototype.set=function(a,b){var d=this;angular.isObject(a)?angular.forEach(a,function(a,b){a?d.hashStateCache[b]=a:delete d.hashStateCache[b]}):b?this.hashStateCache[a]=b:delete this.hashStateCache[a],this.initialized&&this.location.hash(c.param(this.hashStateCache))},d.prototype.clear=function(){this.location.hash("")},d}]),angular.module("ponmApp.services").factory("alertService",["$window","$rootScope","$timeout","jsUtils",function(a,b,c){var d;return d={options:{ttl:3e3},add:function(a,b,d){var e=this,f={type:a,message:b,close:function(){return e.closeAlert(this)}};(d&&d.alone||this.options.alone)&&this.clear();var g=d&&d.ttl||this.options.ttl;return g&&(f.timeoutPromise=c(function(){f.close()},g)),this.alerts.push(f),f},closeAlert:function(a){return this.closeAlertIdx(this.alerts.indexOf(a))},closeAlertIdx:function(a){return this.alerts.splice(a,1)},clear:function(){angular.forEach(this.alerts,function(a){c.cancel(a.timeoutPromise)}),this.alerts=[]},alerts:[]}}]),angular.module("ponmApp.services").service("dialogService",["$window","$rootScope","$modal","jsUtils",function(a,b,c){var d={backdrop:!0,keyboard:!0,modalFade:!0,templateUrl:"views/ponm.dialog.html"},e={closeButtonText:"Close",actionButtonText:"OK",headerText:"Proceed?",bodyText:"Perform this action?"};this.showModal=function(a,b){return a||(a={}),a.backdrop="static",this.show(a,b)},this.show=function(a,b){var f={},g={};return angular.extend(f,d,a),angular.extend(g,e,b),f.controller||(f.controller=function(a,b){a.modalOptions=g,a.modalOptions.ok=function(a){b.close(a)},a.modalOptions.close=function(){b.dismiss("cancel")}}),c.open(f).result}}]),angular.module("ponmApp.services").factory("jsUtils",["$window",function(){function a(b,c,d,e){var f;if(angular.isArray(c))angular.forEach(c,function(c,f){d||rbracket.test(b)?e(b,c):a(b+"["+("object"==typeof c?f:"")+"]",c,d,e)});else if(d||"object"!==jQuery.type(c))e(b,c);else for(f in c)a(b+"["+f+"]",c[f],d,e)}var b=/%20/g,c=decodeURIComponent;return{Array:{containKeys:function(a,b,c){var d=!1;return angular.forEach(a,function(a){a[b]==c&&(d=!0)}),d},removeItem:function(a,b,c){2==arguments.length&&(c=b,b=null);var d;for(d=a.length-1;d>=0;d-=1)(b&&a[d][b]==c||a[d]==c)&&delete a.splice(d,1)},mergeRightist:function(a,b,c){var d;for(d=a.length-1;d>=0;d-=1){var e=!1;angular.forEach(b,function(b){a[d][c]==b[c]&&(e=!0)}),e||delete a.splice(d,1)}for(d=b.length-1;d>=0;d-=1){var e=!1;angular.forEach(a,function(a){a[c]==b[d][c]&&(e=!0)}),e||a.push(b[d])}return a},append:function(a,b,c){var d;for(d=b.length-1;d>=0;d-=1){var e=!1;angular.forEach(a,function(a){a[c]==b[d][c]&&(e=!0)}),e||a.push(b[d])}return a}},param:function(c,d){var e,f=[],g=function(a,b){b=angular.isFunction(b)?b():null==b?"":b,f[f.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(angular.isArray(c)||c.jquery&&!angular.isObject(c))angular.forEach(c,function(){g(this.name,this.value)});else for(e in c)a(e,c[e],d,g);return f.join("&").replace(b,"+")},deparam:function(a,b){var d={},e={"true":!0,"false":!1,"null":null};return angular.forEach(a.replace(/\+/g," ").split("&"),function(a){var f,g=a.split("="),h=c(g[0]),i=d,j=0,k=h.split("]["),l=k.length-1;if(/\[/.test(k[0])&&/\]$/.test(k[l])?(k[l]=k[l].replace(/\]$/,""),k=k.shift().split("[").concat(k),l=k.length-1):l=0,2===g.length)if(f=c(g[1]),b&&(f=f&&!isNaN(f)?+f:"undefined"===f?void 0:void 0!==e[f]?e[f]:f),l)for(;l>=j;j++)h=""===k[j]?i.length:k[j],i=i[h]=l>j?i[h]||(k[j+1]&&isNaN(k[j+1])?{}:[]):f;else angular.isArray(d[h])?d[h].push(f):d[h]=void 0!==d[h]?[d[h],f]:f;else h&&(d[h]=b?void 0:"")}),d},uuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})}}}]),function(a,b){b.module("ponm.Matchmedia",[]).provider("matchmedia",function(){var a={rules:{print:"print",screen:"screen",phone:"(max-width: 767px)",tablet:"(min-width: 768px) and (max-width: 979px)",desktop:"(min-width: 979px)",portrait:"(orientation: portrait)",landscape:"(orientation: landscape)"}};return a.$get=["$window","safeApply","logger",function(b,c,d){function e(a,b){return function(d){c(b,function(){a(d)})}}d.log("Creating matchmedia");var f={};return f.on=function(a,c,f){d.log("adding listener for query: "+a);var g=b.matchMedia(a),h=e(c,f);return g.addListener(h),h(g),function(){d.log("removing listener from query: "+a),g.removeListener(h)}},f.is=function(a){return d.log("test query: "+a),b.matchMedia(a).matches},f.onPrint=function(b,c){return f.on(a.rules.print,b,c)},f.onScreen=function(b,c){return f.on(a.rules.screen,b,c)},f.onPhone=function(b,c){return f.on(a.rules.phone,b,c)},f.onTablet=function(b,c){return f.on(a.rules.tablet,b,c)},f.onDesktop=function(b,c){return f.on(a.rules.desktop,b,c)},f.onPortrait=function(b,c){return f.on(a.rules.portrait,b,c)},f.onLandscape=function(b,c){return f.on(a.rules.landscape,b,c)},f.isPrint=function(){return f.is(a.rules.print)},f.isScreen=function(){return f.is(a.rules.screen)},f.isPhone=function(){return f.is(a.rules.phone)},f.isTablet=function(){return f.is(a.rules.tablet)},f.isDesktop=function(){return f.is(a.rules.desktop)},f.isPortrait=function(){return f.is(a.rules.portrait)},f.isLandscape=function(){return f.is(a.rules.landscape)},f}],a}).provider("logger",function(){this.DEVMODE=!1,this.setDEVMODE=function(a){this.DEVMODE=a},this.$get=["$window","$log",function(a,b){var c=this.DEVMODE,d={};return d.log=function(){c&&b.info(arguments)},d.always=function(){b.info(arguments)},d}]})}(window,window.angular),angular.module("ponmApp.services").factory("rgbHex",["$q",function(){function a(a){return!isNaN(parseFloat(a))&&isFinite(a)}function b(a){return a.replace(/^\s+|\s+$/g,"")}function c(c){return angular.isString(c)&&(c=b(c)),a(c)&&c>=0&&255>=c}function d(a){return/^[0-9a-f]{3}$|^[0-9a-f]{6}$/i.test(b(a))}function e(a){return a=parseInt(a,10).toString(16),1===a.length?"0"+a:a}function f(a){return parseInt(a,16).toString()}function g(b){return angular.isArray(b)||(b=b.split(",")),(3===b.length||4===b.length)&&c(b[0])&&c(b[1])&&c(b[2])?4!==b.length||a(b[3])?"#"+e(b[0]).toUpperCase()+e(b[1]).toUpperCase()+e(b[2]).toUpperCase():null:null}function h(a){return d(a)?(3===a.length&&(a=a.charAt(0)+a.charAt(0)+a.charAt(1)+a.charAt(1)+a.charAt(2)+a.charAt(2)),"rgb("+f(a.substr(0,2))+","+f(a.substr(2,2))+","+f(a.substr(4,2))+")"):void 0}function i(a){return a.replace(/\s/g,"")}return function(a){if(!a)return null;var c=null,d=/^rgba?\((.*)\);?$/,e=/^#/;return angular.isArray(a)?g(a):(a=b(a.toString()),"transparent"===a||"rgba(0,0,0,0)"===i(a)?"transparent":d.test(a)?g(a.match(d)[1]):e.test(a)?h(a.split("#").reverse()[0]):(c=a.split(","),1===c.length?h(a):3===c.length||4===c.length?g(a):void 0))}}]),angular.module("ponmApp.services").factory("TravelManager",["$q","TravelService",function(){function a(a){this.travel=a,a&&(a.photos=[],angular.forEach(a.spots,function(b){a.photos=a.photos.concat(b.photos)})),this.calculate=function(){var a=this.travel;a.photo_size=0,angular.forEach(a.spots,function(b){angular.forEach(b.photos,function(a){b.time_start=b.time_start||a.date_time,b.time_end=b.time_end||a.date_time,b.time_start>a.date_time&&(b.time_start=a.date_time),b.time_end<a.date_time&&(b.time_end=a.date_time)}),b.photos.sort(function(a,b){return a.date_time-b.date_time}),a.photo_size+=b.photos.length,a.time_start=a.time_start||b.time_start,b.time_start<a.time_start&&(a.time_start=b.time_start);var c=b.time_end||b.time_start;a.time_end=a.time_end||c,c>a.time_end&&(a.time_end=c)}),a.spots.sort(function(a,b){return a.time_start-b.time_start}),angular.forEach(a.spots,function(b){b.day=Math.ceil((b.time_start-a.time_start)/864e5)+1})}}return a}]);